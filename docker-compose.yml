version: "3.8"

services:
  moodle:
    image: moodle-web:latest        # your custom Moodle image
    container_name: moodle-web
    restart: unless-stopped
    ports:
      - "8081:80"                   # access Moodle at http://localhost:8081
    volumes:
      - moodle_data:/var/www/moodledata   # persist Moodle data directory
    environment:
      - MOODLE_DOCKER_DBTYPE=mysqli
      - MOODLE_DOCKER_DBHOST=db
      - MOODLE_DOCKER_DBNAME=moodle
      - MOODLE_DOCKER_DBUSER=moodle
      - MOODLE_DOCKER_DBPASS=${MOODLE_DB_PASSWORD}
    depends_on:
      - db

  db:
    image: mariadb:10.11            # official MariaDB image
    container_name: moodle-db
    restart: unless-stopped
    environment:
      - MYSQL_ROOT_PASSWORD=${MARIADB_ROOT_PASSWORD}
      - MYSQL_DATABASE=moodle
      - MYSQL_USER=moodle
      - MYSQL_PASSWORD=${MOODLE_DB_PASSWORD}
    volumes:
      - mariadb_data:/var/lib/mysql

volumes:
  moodle_data:
  mariadb_data:
