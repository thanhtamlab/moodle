version: "3.8"

services:
  moodle:
    image: moodle-web:latest        # use the custom image you built
    container_name: moodle-web
    restart: unless-stopped
    ports:
      - "8080:80"                   # access via http://localhost:8080
    volumes:
      - ./src:/var/www/html         # Moodle source code
      - moodle_data:/var/www/moodledata
    environment:
      - MOODLE_DOCKER_DBTYPE=mysqli
      - MOODLE_DOCKER_DBHOST=db
      - MOODLE_DOCKER_DBNAME=moodle
      - MOODLE_DOCKER_DBUSER=moodle
      - MOODLE_DOCKER_DBPASS=${MOODLE_DB_PASSWORD}
    depends_on:
      - db

  db:
    image: mariadb:10.11            # official MariaDB image from Docker Hub
    container_name: moodle-db
    restart: unless-stopped
    environment:
      - MYSQL_ROOT_PASSWORD=${MARIADB_ROOT_PASSWORD}
      - MYSQL_DATABASE=moodle
      - MYSQL_USER=moodle
      - MYSQL_PASSWORD=${MOODLE_DB_PASSWORD}
    volumes:
      - mariadb_data:/var/lib/mysql

volumes:
  moodle_data:
  mariadb_data: